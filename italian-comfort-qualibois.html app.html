<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Italian Comfort - Dimensionnement NF EN 12831-1</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --blue-primary: #1a4d7a;
            --blue-dark: #0d2a47;
            --orange-accent: #ff8c00;
            --orange-light: #ffa940;
            --white: #ffffff;
            --gray-light: #f5f7fa;
            --gray-medium: #e0e6ed;
            --gray-dark: #475569;
            --text-dark: #1e293b;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, var(--blue-primary) 0%, var(--blue-dark) 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-dark);
        }

        .logo-container {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--white);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .logo-container img {
            max-width: 300px;
            height: auto;
        }

        .company-info {
            text-align: center;
            color: var(--gray-dark);
            margin-top: 15px;
        }

        .company-info h2 {
            color: var(--blue-primary);
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .company-info p {
            font-size: 14px;
            color: var(--gray-dark);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .card {
            background: var(--white);
            border-radius: 20px;
            padding: 35px;
            margin-bottom: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 3px solid var(--orange-accent);
        }

        .card-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--orange-accent), var(--orange-light));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .card-title {
            font-size: 22px;
            font-weight: 700;
            color: var(--blue-primary);
        }

        .form-section {
            margin-bottom: 30px;
        }

        .section-subtitle {
            font-size: 18px;
            font-weight: 600;
            color: var(--blue-dark);
            margin-bottom: 20px;
            padding-left: 15px;
            border-left: 4px solid var(--orange-accent);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 8px;
            font-size: 14px;
        }

        label .required {
            color: var(--error);
            margin-left: 3px;
        }

        input[type="text"],
        input[type="number"],
        input[type="email"],
        select {
            padding: 12px 15px;
            border: 2px solid var(--gray-medium);
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s;
            background: var(--white);
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        input[type="email"]:focus,
        select:focus {
            outline: none;
            border-color: var(--orange-accent);
            box-shadow: 0 0 0 4px rgba(255, 140, 0, 0.1);
        }

        .room-container {
            border: 2px solid var(--gray-medium);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            background: var(--gray-light);
            position: relative;
        }

        .room-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .room-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--blue-primary);
        }

        .btn-remove-room {
            background: var(--error);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-remove-room:hover {
            background: #dc2626;
            transform: scale(1.05);
        }

        .paroi-group {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid var(--orange-accent);
        }

        .paroi-header {
            font-weight: 600;
            color: var(--blue-dark);
            margin-bottom: 15px;
            font-size: 16px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--orange-accent), var(--orange-light));
            color: white;
            border: none;
            padding: 15px 35px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 140, 0, 0.3);
            width: 100%;
            margin-top: 10px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 140, 0, 0.4);
        }

        .btn-secondary {
            background: var(--blue-primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-secondary:hover {
            background: var(--blue-dark);
            transform: translateY(-2px);
        }

        .results {
            display: none;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 40px;
            border-radius: 20px;
            margin-top: 30px;
            box-shadow: 0 15px 50px rgba(16, 185, 129, 0.3);
        }

        .results.show {
            display: block;
            animation: slideIn 0.6s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-main {
            text-align: center;
            margin-bottom: 30px;
        }

        .result-value {
            font-size: 64px;
            font-weight: 900;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .result-label {
            font-size: 20px;
            opacity: 0.95;
            font-weight: 600;
        }

        .result-details {
            background: rgba(255,255,255,0.15);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .result-section {
            margin-bottom: 25px;
        }

        .result-section h3 {
            font-size: 18px;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-item-label {
            font-weight: 500;
        }

        .result-item-value {
            font-weight: 700;
            font-size: 16px;
        }

        .room-results {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .btn-print {
            background: white;
            color: var(--success);
            border: 2px solid white;
            padding: 15px 35px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
            transition: all 0.3s;
        }

        .btn-print:hover {
            background: rgba(255,255,255,0.9);
            transform: translateY(-2px);
        }

        .info-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 14px;
            color: #856404;
        }

        .info-box strong {
            display: block;
            margin-bottom: 5px;
        }

        @media print {
            body {
                background: white;
                padding: 20px;
            }
            
            .card, .results {
                box-shadow: none;
                page-break-inside: avoid;
            }
            
            .btn-primary, .btn-secondary, .btn-print, .btn-remove-room {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .result-value {
                font-size: 48px;
            }
            
            .card {
                padding: 20px;
            }
        }

        .help-text {
            font-size: 12px;
            color: var(--gray-dark);
            margin-top: 5px;
            font-style: italic;
        }

        .coefficient-display {
            background: var(--gray-light);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 13px;
            margin-top: 10px;
            color: var(--blue-dark);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid var(--gray-medium);
            border-top: 4px solid var(--orange-accent);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- LOGO E HEADER -->
        <div class="logo-container">
            <svg width="300" height="200" viewBox="0 0 300 200" xmlns="http://www.w3.org/2000/svg">
                <!-- Maison -->
                <path d="M150 40 L100 80 L100 140 L200 140 L200 80 Z" fill="none" stroke="#1a4d7a" stroke-width="8"/>
                <path d="M150 40 L200 80" fill="none" stroke="#1a4d7a" stroke-width="8"/>
                
                <!-- Fiocco di neve -->
                <line x1="150" y1="85" x2="150" y2="115" stroke="white" stroke-width="6"/>
                <line x1="135" y1="100" x2="165" y2="100" stroke="white" stroke-width="6"/>
                <line x1="140" y1="90" x2="160" y2="110" stroke="white" stroke-width="6"/>
                <line x1="160" y1="90" x2="140" y2="110" stroke="white" stroke-width="6"/>
                
                <!-- Fiamma arancione -->
                <path d="M150 70 Q145 80 150 90 Q155 85 150 70 Z" fill="#ff8c00"/>
                <path d="M150 75 Q148 82 150 88 Q152 84 150 75 Z" fill="#ffa940"/>
                
                <!-- Testo -->
                <text x="150" y="165" font-family="Arial, sans-serif" font-size="32" font-weight="bold" fill="#1a4d7a" text-anchor="middle">ITALIAN COMFORT</text>
                <text x="150" y="185" font-family="Arial, sans-serif" font-size="14" fill="#475569" text-anchor="middle">CHAUFFAGE & CLIMATISATION</text>
            </svg>
            
            <div class="company-info">
                <p><strong>üìß</strong> italiancomfort.services@gmail.com</p>
                <p><strong>üìç</strong> 69150 D√©cines-Charpieu, France</p>
                <p style="margin-top: 10px; color: var(--orange-accent); font-weight: 600;">
                    Dimensionnement conforme NF EN 12831-1
                </p>
            </div>
        </div>

        <!-- FORMULAIRE -->
        <form id="calculForm">
            <!-- DONN√âES CLIENT -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üë§</div>
                    <h2 class="card-title">Donn√©es Client</h2>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Nom et Pr√©nom <span class="required">*</span></label>
                        <input type="text" id="nomClient" required>
                    </div>
                    <div class="form-group">
                        <label>T√©l√©phone</label>
                        <input type="text" id="telephone">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Adresse compl√®te <span class="required">*</span></label>
                        <input type="text" id="adresse" required>
                    </div>
                    <div class="form-group">
                        <label>Code Postal</label>
                        <input type="text" id="codePostal">
                    </div>
                </div>
            </div>

            <!-- LOCALISATION ET CLIMAT -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üåç</div>
                    <h2 class="card-title">Localisation et Climat</h2>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Zone climatique <span class="required">*</span></label>
                        <select id="zoneClimatique" required>
                            <option value="">S√©lectionner...</option>
                            <option value="H1a">H1a - Nord-Est (Alsace, Lorraine)</option>
                            <option value="H1b">H1b - Est (Franche-Comt√©, Bourgogne)</option>
                            <option value="H1c" selected>H1c - Centre-Est (Rh√¥ne-Alpes, Auvergne)</option>
                            <option value="H2a">H2a - Ouest (Bretagne, Normandie)</option>
                            <option value="H2b">H2b - Sud-Ouest (Aquitaine)</option>
                            <option value="H2c">H2c - Centre (√éle-de-France, Centre-Val de Loire)</option>
                            <option value="H2d">H2d - Poitou-Charentes, Limousin</option>
                            <option value="H3">H3 - Sud (PACA, Occitanie, Corse)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Altitude <span class="required">*</span></label>
                        <select id="altitude" required>
                            <option value="0-200">0-200 m</option>
                            <option value="200-400" selected>200-400 m</option>
                            <option value="400-800">400-800 m</option>
                            <option value=">800">> 800 m</option>
                        </select>
                    </div>
                </div>
                
                <div class="coefficient-display" id="tempDisplay">
                    <strong>Temp√©rature ext√©rieure de base:</strong> <span id="tempValue">-9.5¬∞C</span>
                </div>
            </div>

            <!-- CARACT√âRISTIQUES B√ÇTIMENT -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üè†</div>
                    <h2 class="card-title">Caract√©ristiques du B√¢timent</h2>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Ann√©e de construction <span class="required">*</span></label>
                        <input type="number" id="anneeConstruction" min="1800" max="2025" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Type de ventilation <span class="required">*</span></label>
                        <select id="typeVentilation" required>
                            <option value="naturelle">Ventilation naturelle (n=1.0 vol/h)</option>
                            <option value="vmc-auto" selected>VMC autor√©glable (n=0.6 vol/h)</option>
                            <option value="vmc-hygro">VMC hygror√©glable (n=0.4 vol/h)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- PI√àCES -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üö™</div>
                    <h2 class="card-title">Pi√®ces √† Chauffer</h2>
                </div>
                
                <div id="roomsContainer"></div>
                
                <button type="button" class="btn-secondary" onclick="addRoom()">
                    ‚ûï Ajouter une pi√®ce
                </button>
            </div>

            <!-- TYPE D'INSTALLATION -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üî•</div>
                    <h2 class="card-title">Type d'Installation</h2>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Type de chaudi√®re <span class="required">*</span></label>
                        <select id="typeChaudiere" required>
                            <option value="">S√©lectionner...</option>
                            <option value="buches">Chaudi√®re √† b√ªches</option>
                            <option value="granules">Chaudi√®re √† granul√©s</option>
                            <option value="poele-hydro">Po√™le hydraulique</option>
                            <option value="mixte">Installation mixte</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Production ECS <span class="required">*</span></label>
                        <select id="productionECS" required>
                            <option value="oui">Oui</option>
                            <option value="non">Non</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Nombre de personnes</label>
                        <input type="number" id="nombrePersonnes" min="1" value="3">
                    </div>
                </div>
            </div>

            <div class="info-box">
                <strong>‚ÑπÔ∏è M√©thode de calcul</strong>
                Calcul conforme √† la norme NF EN 12831-1:2017 - M√©thode officielle enseign√©e dans le cours Qualibois Eau (Qualit'EnR)
            </div>

            <button type="submit" class="btn-primary">
                üßÆ Calculer le dimensionnement
            </button>
        </form>

        <!-- LOADING -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Calcul en cours selon NF EN 12831-1...</p>
        </div>

        <!-- R√âSULTATS -->
        <div class="results" id="results">
            <div class="result-main">
                <div class="result-label">Puissance Chaudi√®re Recommand√©e</div>
                <div class="result-value" id="puissanceTotale">0 kW</div>
                <p style="opacity: 0.9;">Conforme NF EN 12831-1</p>
            </div>
            
            <div class="result-details">
                <div class="result-section">
                    <h3>üìã Informations Client</h3>
                    <div class="result-item">
                        <span class="result-item-label">Client:</span>
                        <span class="result-item-value" id="resNomClient"></span>
                    </div>
                    <div class="result-item">
                        <span class="result-item-label">Adresse:</span>
                        <span class="result-item-value" id="resAdresse"></span>
                    </div>
                    <div class="result-item">
                        <span class="result-item-label">Zone climatique:</span>
                        <span class="result-item-value" id="resZone"></span>
                    </div>
                    <div class="result-item">
                        <span class="result-item-label">Temp√©rature ext. base:</span>
                        <span class="result-item-value" id="resTempExt"></span>
                    </div>
                </div>
                
                <div class="result-section">
                    <h3>üî• D√©tails Calcul Thermique</h3>
                    <div id="detailsPieces"></div>
                    
                    <div class="result-item" style="border-top: 2px solid white; margin-top: 15px; padding-top: 15px; font-size: 18px;">
                        <span class="result-item-label"><strong>D√©perditions totales (Œ¶):</strong></span>
                        <span class="result-item-value" id="resDeperditions"></span>
                    </div>
                </div>
                
                <div class="result-section">
                    <h3>‚öôÔ∏è Dimensionnement Installation</h3>
                    <div class="result-item">
                        <span class="result-item-label">Type installation:</span>
                        <span class="result-item-value" id="resTypeChaudiere"></span>
                    </div>
                    <div class="result-item">
                        <span class="result-item-label">Puissance ECS:</span>
                        <span class="result-item-value" id="resPuissanceECS"></span>
                    </div>
                    <div class="result-item">
                        <span class="result-item-label">Marge s√©curit√© (15%):</span>
                        <span class="result-item-value" id="resMarge"></span>
                    </div>
                    <div class="result-item">
                        <span class="result-item-label">Volume ballon tampon:</span>
                        <span class="result-item-value" id="resVolumePuffer"></span>
                    </div>
                </div>
                
                <div class="result-section">
                    <h3>üí° Recommandation Technique</h3>
                    <p id="recommandation" style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; line-height: 1.6;"></p>
                </div>
            </div>
            
            <button onclick="window.print()" class="btn-print">
                üñ®Ô∏è Imprimer le rapport
            </button>
        </div>
    </div>

    <script>
        // TEMP√âRATURES EXTERNES DE BASE NF EN 12831-1
        const temperaturesBase = {
            'H1a': {'0-200': -9.5, '200-400': -9.5, '400-800': -11.5, '>800': -13.5},
            'H1b': {'0-200': -9.5, '200-400': -9.5, '400-800': -11.5, '>800': -13.5},
            'H1c': {'0-200': -9.5, '200-400': -9.5, '400-800': -11.5, '>800': -13.5},
            'H2a': {'0-200': -6.5, '200-400': -6.5, '400-800': -8.5, '>800': -10.5},
            'H2b': {'0-200': -6.5, '200-400': -6.5, '400-800': -8.5, '>800': -10.5},
            'H2c': {'0-200': -6.5, '200-400': -6.5, '400-800': -8.5, '>800': -10.5},
            'H2d': {'0-200': -6.5, '200-400': -6.5, '400-800': -8.5, '>800': -10.5},
            'H3': {'0-200': -3.5, '200-400': -3.5, '400-800': -5.5, '>800': -7.5}
        };

        // COEFFICIENTS U (W/m¬≤K) - QUALIBOIS
        const coefficientsU = {
            murs: {
                'non-isole': 2.0,
                'isole-5cm': 0.7,
                'isole-10cm': 0.35,
                'isole-15cm': 0.25
            },
            fenetres: {
                'simple': 5.5,
                'double-ancien': 2.8,
                'double-perf': 1.5,
                'triple': 0.9
            },
            toiture: {
                'non-isole': 2.2,
                'isole-10cm': 0.45,
                'isole-20cm': 0.22,
                'isole-30cm': 0.15
            },
            plancher: {
                'terre-plein': 0.8,
                'vide-sanitaire': 1.0,
                'local-non-chauffe': 1.2
            }
        };

        // TAUX RENOUVELLEMENT AIR
        const tauxVentilation = {
            'naturelle': 1.0,
            'vmc-auto': 0.6,
            'vmc-hygro': 0.4
        };

        let roomCount = 0;

        // UPDATE TEMP√âRATURE AFFICH√âE
        document.getElementById('zoneClimatique').addEventListener('change', updateTemperature);
        document.getElementById('altitude').addEventListener('change', updateTemperature);

        function updateTemperature() {
            const zone = document.getElementById('zoneClimatique').value;
            const altitude = document.getElementById('altitude').value;
            
            if (zone && altitude) {
                const temp = temperaturesBase[zone][altitude];
                document.getElementById('tempValue').textContent = temp + '¬∞C';
            }
        }

        // AJOUTER UNE PI√àCE
        function addRoom() {
            roomCount++;
            const roomHtml = `
                <div class="room-container" id="room${roomCount}">
                    <div class="room-header">
                        <h3 class="room-title">Pi√®ce ${roomCount}</h3>
                        <button type="button" class="btn-remove-room" onclick="removeRoom(${roomCount})">
                            ‚ùå Supprimer
                        </button>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nom de la pi√®ce <span class="required">*</span></label>
                            <input type="text" name="room${roomCount}_nom" placeholder="ex: Salon" required>
                        </div>
                        <div class="form-group">
                            <label>Volume (m¬≥) <span class="required">*</span></label>
                            <input type="number" name="room${roomCount}_volume" step="0.1" min="0" required>
                            <p class="help-text">Surface √ó Hauteur sous plafond</p>
                        </div>
                        <div class="form-group">
                            <label>Temp√©rature int√©rieure (¬∞C)</label>
                            <input type="number" name="room${roomCount}_temp" value="20" step="0.5" min="15" max="25">
                        </div>
                    </div>
                    
                    <div class="section-subtitle">Murs ext√©rieurs</div>
                    <div class="paroi-group">
                        <div class="paroi-header">Mur Nord</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Surface (m¬≤)</label>
                                <input type="number" name="room${roomCount}_mur_nord_surface" step="0.1" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>Type d'isolation</label>
                                <select name="room${roomCount}_mur_nord_type">
                                    <option value="non-isole">Non isol√© (U=2.0)</option>
                                    <option value="isole-5cm">Isol√© 5cm (U=0.7)</option>
                                    <option value="isole-10cm" selected>Isol√© 10cm (U=0.35)</option>
                                    <option value="isole-15cm">Isol√© 15cm+ (U=0.25)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="paroi-group">
                        <div class="paroi-header">Mur Sud</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Surface (m¬≤)</label>
                                <input type="number" name="room${roomCount}_mur_sud_surface" step="0.1" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>Type d'isolation</label>
                                <select name="room${roomCount}_mur_sud_type">
                                    <option value="non-isole">Non isol√© (U=2.0)</option>
                                    <option value="isole-5cm">Isol√© 5cm (U=0.7)</option>
                                    <option value="isole-10cm" selected>Isol√© 10cm (U=0.35)</option>
                                    <option value="isole-15cm">Isol√© 15cm+ (U=0.25)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="paroi-group">
                        <div class="paroi-header">Mur Est</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Surface (m¬≤)</label>
                                <input type="number" name="room${roomCount}_mur_est_surface" step="0.1" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>Type d'isolation</label>
                                <select name="room${roomCount}_mur_est_type">
                                    <option value="non-isole">Non isol√© (U=2.0)</option>
                                    <option value="isole-5cm">Isol√© 5cm (U=0.7)</option>
                                    <option value="isole-10cm" selected>Isol√© 10cm (U=0.35)</option>
                                    <option value="isole-15cm">Isol√© 15cm+ (U=0.25)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="paroi-group">
                        <div class="paroi-header">Mur Ouest</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Surface (m¬≤)</label>
                                <input type="number" name="room${roomCount}_mur_ouest_surface" step="0.1" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>Type d'isolation</label>
                                <select name="room${roomCount}_mur_ouest_type">
                                    <option value="non-isole">Non isol√© (U=2.0)</option>
                                    <option value="isole-5cm">Isol√© 5cm (U=0.7)</option>
                                    <option value="isole-10cm" selected>Isol√© 10cm (U=0.35)</option>
                                    <option value="isole-15cm">Isol√© 15cm+ (U=0.25)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="section-subtitle">Fen√™tres</div>
                    <div class="paroi-group">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Surface totale fen√™tres (m¬≤)</label>
                                <input type="number" name="room${roomCount}_fenetres_surface" step="0.1" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>Type de vitrage</label>
                                <select name="room${roomCount}_fenetres_type">
                                    <option value="simple">Simple vitrage (U=5.5)</option>
                                    <option value="double-ancien">Double vitrage ancien (U=2.8)</option>
                                    <option value="double-perf" selected>Double vitrage performant (U=1.5)</option>
                                    <option value="triple">Triple vitrage (U=0.9)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="section-subtitle">Toiture/Plafond</div>
                    <div class="paroi-group">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Surface plafond (m¬≤)</label>
                                <input type="number" name="room${roomCount}_plafond_surface" step="0.1" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>Type d'isolation</label>
                                <select name="room${roomCount}_plafond_type">
                                    <option value="non-isole">Non isol√© (U=2.2)</option>
                                    <option value="isole-10cm">Isol√© 10cm (U=0.45)</option>
                                    <option value="isole-20cm" selected>Isol√© 20cm (U=0.22)</option>
                                    <option value="isole-30cm">Isol√© 30cm+ (U=0.15)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Contact avec</label>
                                <select name="room${roomCount}_plafond_contact">
                                    <option value="exterieur">Ext√©rieur (b=1.0)</option>
                                    <option value="combles" selected>Combles non chauff√©s (b=0.9)</option>
                                    <option value="autre-logement">Autre logement (b=0.5)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="section-subtitle">Plancher</div>
                    <div class="paroi-group">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Surface plancher (m¬≤)</label>
                                <input type="number" name="room${roomCount}_plancher_surface" step="0.1" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>Type de plancher</label>
                                <select name="room${roomCount}_plancher_type">
                                    <option value="terre-plein" selected>Terre-plein (U=0.8)</option>
                                    <option value="vide-sanitaire">Vide sanitaire (U=1.0)</option>
                                    <option value="local-non-chauffe">Local non chauff√© (U=1.2)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Facteur b</label>
                                <select name="room${roomCount}_plancher_b">
                                    <option value="0.5" selected>b=0.5 (terre-plein, cave)</option>
                                    <option value="0.8">b=0.8 (vide sanitaire)</option>
                                    <option value="1.0">b=1.0 (ext√©rieur)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('roomsContainer').insertAdjacentHTML('beforeend', roomHtml);
        }

        function removeRoom(roomId) {
            const room = document.getElementById('room' + roomId);
            if (room) {
                room.remove();
            }
        }

        // Ajouter la premi√®re pi√®ce automatiquement
        window.addEventListener('DOMContentLoaded', () => {
            addRoom();
            updateTemperature();
        });

        // CALCUL PRINCIPAL
        document.getElementById('calculForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Afficher loading
            document.getElementById('loading').classList.add('show');
            document.getElementById('results').classList.remove('show');
            
            setTimeout(() => {
                calculateDimensionnement();
                document.getElementById('loading').classList.remove('show');
                document.getElementById('results').classList.add('show');
                document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
            }, 1500);
        });

        function calculateDimensionnement() {
            const formData = new FormData(document.getElementById('calculForm'));
            
            // Donn√©es g√©n√©rales
            const nomClient = document.getElementById('nomClient').value;
            const adresse = document.getElementById('adresse').value;
            const zone = document.getElementById('zoneClimatique').value;
            const altitude = document.getElementById('altitude').value;
            const tempExt = temperaturesBase[zone][altitude];
            const typeVentilation = document.getElementById('typeVentilation').value;
            const n = tauxVentilation[typeVentilation];
            
            let deperditionsTotales = 0;
            let detailsPiecesHtml = '';
            
            // Calculer pour chaque pi√®ce
            for (let i = 1; i <= roomCount; i++) {
                const roomElement = document.getElementById('room' + i);
                if (!roomElement) continue;
                
                const nomPiece = formData.get(`room${i}_nom`);
                const volume = parseFloat(formData.get(`room${i}_volume`) || 0);
                const tempInt = parseFloat(formData.get(`room${i}_temp`) || 20);
                const deltaT = tempInt - tempExt;
                
                // Calcul Ht (d√©perditions par transmission)
                let Ht = 0;
                
                // Murs
                ['nord', 'sud', 'est', 'ouest'].forEach(orientation => {
                    const surface = parseFloat(formData.get(`room${i}_mur_${orientation}_surface`) || 0);
                    const type = formData.get(`room${i}_mur_${orientation}_type`);
                    const U = coefficientsU.murs[type];
                    const b = 1.0; // Murs ext√©rieurs
                    Ht += surface * U * b;
                });
                
                // Fen√™tres
                const surfaceFenetres = parseFloat(formData.get(`room${i}_fenetres_surface`) || 0);
                const typeFenetres = formData.get(`room${i}_fenetres_type`);
                const UFenetres = coefficientsU.fenetres[typeFenetres];
                Ht += surfaceFenetres * UFenetres * 1.0;
                
                // Plafond
                const surfacePlafond = parseFloat(formData.get(`room${i}_plafond_surface`) || 0);
                const typePlafond = formData.get(`room${i}_plafond_type`);
                const contactPlafond = formData.get(`room${i}_plafond_contact`);
                const UPlafond = coefficientsU.toiture[typePlafond];
                const bPlafond = contactPlafond === 'exterieur' ? 1.0 : (contactPlafond === 'combles' ? 0.9 : 0.5);
                Ht += surfacePlafond * UPlafond * bPlafond;
                
                // Plancher
                const surfacePlancher = parseFloat(formData.get(`room${i}_plancher_surface`) || 0);
                const typePlancher = formData.get(`room${i}_plancher_type`);
                const bPlancher = parseFloat(formData.get(`room${i}_plancher_b`));
                const UPlancher = coefficientsU.plancher[typePlancher];
                Ht += surfacePlancher * UPlancher * bPlancher;
                
                // Calcul Hv (d√©perditions par ventilation)
                // Hv = 0.34 √ó V √ó n
                const Hv = 0.34 * volume * n;
                
                // D√©perditions totales de la pi√®ce
                const deperditionsPiece = (Ht + Hv) * deltaT;
                deperditionsTotales += deperditionsPiece;
                
                // Ajouter au d√©tail
                detailsPiecesHtml += `
                    <div class="room-results">
                        <strong>${nomPiece}</strong> (${volume} m¬≥)
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; font-size: 14px;">
                            <div>Ht = ${Ht.toFixed(2)} W/K</div>
                            <div>Hv = ${Hv.toFixed(2)} W/K</div>
                            <div>ŒîT = ${deltaT.toFixed(1)}¬∞C</div>
                            <div><strong>Œ¶ = ${(deperditionsPiece/1000).toFixed(2)} kW</strong></div>
                        </div>
                    </div>
                `;
            }
            
            // Conversion en kW
            deperditionsTotales = deperditionsTotales / 1000;
            
            // Puissance ECS
            const productionECS = document.getElementById('productionECS').value;
            const nombrePersonnes = parseInt(document.getElementById('nombrePersonnes').value);
            let puissanceECS = 0;
            if (productionECS === 'oui') {
                puissanceECS = 5 + Math.max(0, nombrePersonnes - 3);
            }
            
            // Marge de s√©curit√© 15%
            const marge = (deperditionsTotales + puissanceECS) * 0.15;
            
            // Puissance totale
            const puissanceTotale = deperditionsTotales + puissanceECS + marge;
            
            // Volume ballon tampon
            const typeChaudiere = document.getElementById('typeChaudiere').value;
            let volumePuffer = 0;
            let facteurPuffer = 0;
            if (typeChaudiere === 'buches') {
                facteurPuffer = 55; // litres/kW
            } else if (typeChaudiere === 'granules') {
                facteurPuffer = 20; // litres/kW
            } else if (typeChaudiere === 'poele-hydro') {
                facteurPuffer = 30; // litres/kW
            }
            volumePuffer = puissanceTotale * facteurPuffer;
            
            // Afficher les r√©sultats
            document.getElementById('puissanceTotale').textContent = puissanceTotale.toFixed(1) + ' kW';
            document.getElementById('resNomClient').textContent = nomClient;
            document.getElementById('resAdresse').textContent = adresse;
            document.getElementById('resZone').textContent = zone + ' (altitude ' + altitude + ')';
            document.getElementById('resTempExt').textContent = tempExt + '¬∞C';
            
            document.getElementById('detailsPieces').innerHTML = detailsPiecesHtml;
            document.getElementById('resDeperditions').textContent = deperditionsTotales.toFixed(2) + ' kW';
            
            const typeChaudiereTexte = {
                'buches': 'Chaudi√®re √† b√ªches',
                'granules': 'Chaudi√®re √† granul√©s',
                'poele-hydro': 'Po√™le hydraulique',
                'mixte': 'Installation mixte'
            };
            document.getElementById('resTypeChaudiere').textContent = typeChaudiereTexte[typeChaudiere];
            document.getElementById('resPuissanceECS').textContent = puissanceECS.toFixed(1) + ' kW';
            document.getElementById('resMarge').textContent = marge.toFixed(1) + ' kW';
            
            if (volumePuffer > 0) {
                document.getElementById('resVolumePuffer').textContent = Math.round(volumePuffer) + ' litres';
            } else {
                document.getElementById('resVolumePuffer').textContent = 'Non applicable';
            }
            
            // Recommandation
            let recommandation = '';
            if (typeChaudiere === 'buches') {
                recommandation = `Pour cette installation, nous recommandons une chaudi√®re √† b√ªches de ${Math.ceil(puissanceTotale/5)*5} kW avec un ballon tampon de ${Math.round(volumePuffer)} litres. Le dimensionnement du ballon est crucial pour optimiser les cycles de combustion et r√©duire les √©missions.`;
            } else if (typeChaudiere === 'granules') {
                recommandation = `Pour cette installation, nous recommandons une chaudi√®re √† granul√©s de ${Math.ceil(puissanceTotale/5)*5} kW avec un ballon tampon de ${Math.round(volumePuffer)} litres minimum. La modulation de la chaudi√®re permettra une adaptation fine aux besoins.`;
            } else {
                recommandation = `Pour cette installation de ${Math.ceil(puissanceTotale/5)*5} kW, un dimensionnement pr√©cis du syst√®me hydraulique est n√©cessaire pour garantir le confort et l'efficacit√© √©nerg√©tique.`;
            }
            
            recommandation += ` Le calcul a √©t√© r√©alis√© selon la norme NF EN 12831-1:2017 avec une temp√©rature ext√©rieure de base de ${tempExt}¬∞C et une temp√©rature int√©rieure de 20¬∞C.`;
            
            document.getElementById('recommandation').textContent = recommandation;
        }
    </script>
</body>
</html>